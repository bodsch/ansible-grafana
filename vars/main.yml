---

grafana_main_version: "{{ grafana_version[0:3] }}"

grafana_install_path: /usr/local/grafana/{{ grafana_version }}

grafana_delegate_to: localhost

grafana_local_tmp_directory: "{{
  lookup('env', 'CUSTOM_LOCAL_TMP_DIRECTORY') |
  default(lookup('env', 'HOME') ~ '/.cache/ansible/grafana', true) }}/{{ grafana_version }}"

grafana_cache_directory: /var/cache/ansible/grafana

grafana_remote_tmp_directory: "{{ grafana_cache_directory }}/{{ grafana_version }}"

grafana_requirements:
  - iproute2
  - gzip

# https://dl.grafana.com/enterprise/release/grafana-enterprise-9.1.1.linux-amd64.tar.gz
# https://dl.grafana.com/oss/release/grafana-9.1.1.linux-amd64.tar.gz
grafana_download_file: "grafana{{ '-enterprise' if grafana_edition == 'enterprise' else '' }}-{{ grafana_version }}.linux-{{ system_architecture }}.tar.gz"

# ----------------------------------------------------------------------------------------

grafana_defaults_general:
  app_mode: production
  instance_name: "{{ ansible_hostname }}"
  force_migration: false

grafana_defaults_alerting:
  enabled: false
  execute_alerts: true
  error_or_timeout: alerting
  nodata_or_nullvalues: no_data
  concurrent_render_limit: 5
  evaluation_timeout_seconds: 30
  notification_timeout_seconds: 30
  max_attempts: 3
  min_interval_seconds: 1
  max_annotation_age: ""
  max_annotations_to_keep: ""

grafana_defaults_analytics:
  reporting_enabled: false
  reporting_distributor: grafana-labs
  check_for_updates: true
  check_for_plugin_updates: true
  google_analytics_ua_id: ""
  google_tag_manager_id: ""
  rudderstack_write_key: ""
  rudderstack_data_plane_url: ""
  rudderstack_sdk_url: ""
  rudderstack_config_url: ""
  feedback_links_enabled: true

grafana_defaults_annotations:
  cleanupjob_batchsize: 100
  dashboard:
    max_age: ""
    max_annotations_to_keep: ""
  api:
    max_age: ""
    max_annotations_to_keep: ""

grafana_defaults_auth:
  login_cookie_name: grafana_session
  login_maximum_inactive_lifetime_duration: ""
  login_maximum_lifetime_duration: ""
  token_rotation_interval_minutes: 10
  disable_login_form: false
  disable_signout_menu: false
  signout_redirect_url: ""
  oauth_auto_login: false
  oauth_state_cookie_max_age: 600
  oauth_skip_org_role_update_sync: false
  api_key_max_seconds_to_live: -1
  sigv4_auth_enabled: false
  sigv4_verbose_logging: false
  azure_auth_enabled: false

  anonymous:
    enabled: false
    org_name: Main Org.
    org_role: Viewer
    hide_version: false

  github:
    enabled: false
    allow_sign_up: true
    client_id: some_id
    client_secret: some_secret
    scopes: user:email,read:org
    auth_url: https://github.com/login/oauth/authorize
    token_url: https://github.com/login/oauth/access_token
    api_url: https://api.github.com/user
    allowed_domains: ""
    team_ids: ""
    allowed_organizations: ""

  gitlab:
    enabled: false
    allow_sign_up: true
    client_id: some_id
    client_secret: some_secret
    scopes: api
    auth_url: https://gitlab.com/oauth/authorize
    token_url: https://gitlab.com/oauth/token
    api_url: https://gitlab.com/api/v4
    allowed_domains: ""
    allowed_groups: ""

  google:
    enabled: false
    allow_sign_up: true
    client_id: some_client_id
    client_secret: some_client_secret
    scopes: https://www.googleapis.com/auth/userinfo.profile https://www.googleapis.com/auth/userinfo.email
    auth_url: https://accounts.google.com/o/oauth2/auth
    token_url: https://accounts.google.com/o/oauth2/token
    api_url: https://www.googleapis.com/oauth2/v1/userinfo
    allowed_domains: ""
    hosted_domain: ""

  grafana_com:
    enabled: false
    allow_sign_up: true
    client_id: some_id
    client_secret: some_secret
    scopes: user:email
    allowed_organizations: ""

  azuread:
    name: Azure AD
    enabled: false
    allow_sign_up: true
    client_id: some_client_id
    client_secret: some_client_secret
    scopes: openid email profile
    auth_url: https://login.microsoftonline.com/<tenant-id>/oauth2/v2.0/authorize
    token_url: https://login.microsoftonline.com/<tenant-id>/oauth2/v2.0/token
    allowed_domains: ""
    allowed_groups: ""
    role_attribute_strict: false

  okta:
    name: Okta
    enabled: false
    allow_sign_up: true
    client_id: some_id
    client_secret: some_secret
    scopes: openid profile email groups
    auth_url: https://<tenant-id>.okta.com/oauth2/v1/authorize
    token_url: https://<tenant-id>.okta.com/oauth2/v1/token
    api_url: https://<tenant-id>.okta.com/oauth2/v1/userinfo
    allowed_domains: ""
    allowed_groups: ""
    role_attribute_path: ""
    role_attribute_strict: false

  generic_oauth:
    enabled: false
    name: OAuth
    allow_sign_up: true
    client_id: some_id
    client_secret: some_secret
    scopes: user:email,read:org
    empty_scopes: false
    email_attribute_name: email:primary
    email_attribute_path: ""
    login_attribute_path: ""
    name_attribute_path: ""
    id_token_attribute_name: ""
    auth_url: https://foo.bar/login/oauth/authorize
    token_url: https://foo.bar/login/oauth/access_token
    api_url: https://foo.bar/user
    teams_url: ""
    allowed_domains: ""
    team_ids: ""
    allowed_organizations: ""
    role_attribute_path: ""
    role_attribute_strict: false
    groups_attribute_path: ""
    team_ids_attribute_path: ""
    tls_skip_verify_insecure: false
    tls_client_cert: ""
    tls_client_key: ""
    tls_client_ca: ""
    use_pkce: false
    auth_style: ""

  basic:
    enabled: false

  proxy:
    enabled: false
    header_name: X-WEBAUTH-USER
    header_property: username
    auto_sign_up: true
    sync_ttl: 60
    whitelist: 192.168.1.1, 192.168.2.1
    headers: Email:X-User-Email, Name:X-User-Name
    # Non-ASCII strings in header values are encoded using quoted-printable encoding
    headers_encoded: false
    # Read the auth proxy docs for details on what the setting below enables
    enable_login_token: false

  jwt:
    enabled: true
    header_name: X-JWT-Assertion
    email_claim: sub
    username_claim: sub
    jwk_set_url: https://foo.bar/.well-known/jwks.json
    jwk_set_file: /path/to/jwks.json
    cache_ttl: 60m
    expected_claims: {"aud": ["foo", "bar"]}
    key_file: /path/to/key/file
    auto_sign_up: false

  ldap:
    enabled: false
    config_file: /etc/grafana/ldap.toml
    allow_sign_up: true
    # LDAP background sync (Enterprise only)
    # At 1 am every day
    sync_cron: "0 1 * * *"
    active_sync_enabled: true

grafana_defaults_aws: {}
grafana_defaults_azure: {}
grafana_defaults_dashboards: {}
grafana_defaults_database: {}
grafana_defaults_dataproxy: {}
grafana_defaults_datasources: {}
grafana_defaults_date_formats: {}
grafana_defaults_emails: {}
grafana_defaults_enterprise: {}
grafana_defaults_explore: {}
grafana_defaults_expressions: {}
grafana_defaults_external_image_storage: {}
grafana_defaults_feature_toggles: {}
grafana_defaults_geomap: {}
grafana_defaults_grafana_com: {}
grafana_defaults_help: {}
grafana_defaults_live: {}
grafana_defaults_log: {}
grafana_defaults_metrics: {}
grafana_defaults_panels: {}
grafana_defaults_path: {}
grafana_defaults_plugin: {}
grafana_defaults_plugins: {}
grafana_defaults_profile: {}
grafana_defaults_query_history: {}
grafana_defaults_quota: {}
grafana_defaults_rbac: {}
grafana_defaults_remote_cache: {}
grafana_defaults_rendering: {}
grafana_defaults_security: {}
grafana_defaults_server: {}
grafana_defaults_smtp: {}
grafana_defaults_snapshots: {}
grafana_defaults_tracing: {}
grafana_defaults_unified_alerting: {}
grafana_defaults_users: {}

# ----------------------------------------------------------------------------------------

grafana_defaults_directory: /etc/default

go_arch_map:
  x86_64: 'amd64'
  aarch64: 'arm64'
  armv7l: 'armv7'
  armv6l: 'armv6'

system_architecture: "{{ go_arch_map[ansible_architecture] | default(ansible_architecture) }}"

systemd_lib_directory: /lib/systemd/system

...
